<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æˆ‘å’Œ SSD çš„äº²å¯†æ¥è§¦</title>
<link rel="shortcut icon" href="../../assets/img/icon.png" type="image/x-icon"/>
<link rel="icon" href="../../assets/img/icon.png" type="image/x-icon"/>
<link rel="stylesheet" href="../../assets/css/github-markdown.css">
<link rel="stylesheet" href="../../assets/css/index.css">
</head>
<body class="markdown-body">
<p><a href="https://painterdrown.github.io">painterdrown Blog</a> - <a href="https://painterdrown.github.io/cv">painterdrown CV</a></p>
<h1 id="æˆ‘å’Œ-ssd-çš„äº²å¯†æ¥è§¦"><a class="markdownIt-Anchor" href="#æˆ‘å’Œ-ssd-çš„äº²å¯†æ¥è§¦">#</a> æˆ‘å’Œ SSD çš„äº²å¯†æ¥è§¦</h1>
<blockquote>
<p>â° 2018-05-21 08:22:22<br/>
ğŸ‘¨ğŸ»â€ğŸ’» painterdrown</p>
</blockquote>
<p><ul class="markdownIt-TOC">
<li><a href="#%E6%88%91%E5%92%8C-ssd-%E7%9A%84%E4%BA%B2%E5%AF%86%E6%8E%A5%E8%A7%A6">æˆ‘å’Œ SSD çš„äº²å¯†æ¥è§¦</a>
<ul>
<li><a href="#1-%E8%A3%85-caffe">1. è£… caffe</a></li>
<li><a href="#2-%E8%AE%AD%E7%BB%83-%E8%AF%84%E4%BC%B0">2. è®­ç»ƒ &amp; è¯„ä¼°</a>
<ul>
<li><a href="#21-train-evaluate%E9%A1%BA%E4%BE%BF">2.1 Train &amp; Evaluate(é¡ºä¾¿)</a></li>
<li><a href="#22-evaluate">2.2 Evaluate</a></li>
<li><a href="#23-test-using-a-webcam">2.3 Test Using a Webcam</a></li>
<li><a href="#24-test">2.4 Test</a></li>
<li><a href="#25-train-on-other-dataset">2.5 Train on Other Dataset</a></li>
</ul>
</li>
<li><a href="#3-btw">3. BTW</a>
<ul>
<li><a href="#31-linux-%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81">3.1 Linux è¿›ç¨‹çŠ¶æ€</a></li>
<li><a href="#32-tmux-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C">3.2 tmux å¸¸ç”¨æ“ä½œ</a></li>
<li><a href="#33-%E5%9C%A8-macos-terminal-%E9%80%9A%E8%BF%87-ssh-%E6%98%BE%E7%A4%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2">3.3 åœ¨ macOS Terminal é€šè¿‡ ssh æ˜¾ç¤ºæœåŠ¡å™¨çš„å›¾å½¢åŒ–ç•Œé¢</a></li>
</ul>
</li>
<li><a href="#4-resources">4. Resources</a></li>
</ul>
</li>
</ul>
</p>
<h2 id="1-è£…-caffe"><a class="markdownIt-Anchor" href="#1-è£…-caffe">#</a> 1. è£… caffe</h2>
<p>å®éªŒå®¤çš„æœåŠ¡å™¨ï¼ˆUbuntu 16.04ï¼‰å·²ç»è£…å¥½äº† CUDA, cuDNN, OpenCV çš„ç¯å¢ƒï¼Œæ‰€ä»¥ç°åœ¨åªéœ€è¦ç¼–è¯‘ä¸€ä¸‹ Caffe å°±å¯ä»¥è·‘ã€‚</p>
<blockquote>
<p>å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼š<a href="https://github.com/weiliu89/caffe/tree/ssd#installation">https://github.com/weiliu89/caffe/tree/ssd#installation</a></p>
</blockquote>
<p>è·Ÿç€è¿™ä¸ªæ•™ç¨‹èµ°å®Œ <strong>Installation</strong> å’Œ <strong>Preparation</strong>ã€‚</p>
<blockquote>
<p>æˆ‘çš„ <a href="assets/Makefile.config">Makefile.config</a> &amp; <a href="assets/Makefile">Makefile</a></p>
</blockquote>
<p>PS: ç”±äºåœ¨ç¼–è¯‘çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå…³äº <code>hdf5</code> å’Œ <code>undefined reference toã€Œboost::re_detail::raise_runtime_error(std::runtime_error const&amp;)ã€</code> çš„é”™è¯¯ï¼Œéœ€è¦ä¿®æ”¹ä¸‹ Makefile:</p>
<pre><code class="language-sh"># åŸæ¥ç‰ˆæœ¬ï¼šLIBRARIES += glog gflags protobuf boost_system boost_filesystem boost_regex m hdf5_hl hdf5
LIBRARIES += glog gflags protobuf boost_system boost_filesystem m hdf5_serial_hl hdf5_serial boost_thread stdc++ boost_regex
</code></pre>
<p>æˆ‘è¿™è¾¹ <code>make py</code> çš„ç»“æœï¼š</p>
<p><img src="images/make_py.png" alt="make py"></p>
<h2 id="2-è®­ç»ƒ-è¯„ä¼°"><a class="markdownIt-Anchor" href="#2-è®­ç»ƒ-è¯„ä¼°">#</a> 2. è®­ç»ƒ &amp; è¯„ä¼°</h2>
<h3 id="21-train-evaluateé¡ºä¾¿"><a class="markdownIt-Anchor" href="#21-train-evaluateé¡ºä¾¿">#</a> 2.1 Train &amp; Evaluate(é¡ºä¾¿)</h3>
<pre><code class="language-sh"># time: 08:48
python examples/ssd/ssd_pascal.py
</code></pre>
<p>å¼€å§‹è·‘ï¼š</p>
<p><img src="images/train_1.png" alt="train_1"></p>
<p><img src="images/train_2.png" alt="train_1"></p>
<p>ä»¥åŠ GPU çš„çŠ¶æ€å¦‚ä¸‹ï¼ˆzhengzhao æ˜¯æˆ‘ï¼‰ï¼š</p>
<p><img src="images/gpustat.png" alt="gpustat"></p>
<p>åˆšå¼€å§‹ç”¨ <code>tmux</code>ï¼Œä¸å°å¿ƒå…³æ‰äº†çª—å£ï¼Œçœ‹ä¸åˆ°è¾“å‡ºï¼Œåªèƒ½ç­‰å®ƒè·‘å®Œäº†â€¦è¿™æ˜¯ <code>ps</code> æŸ¥åˆ°çš„è¿›ç¨‹çŠ¶æ€ï¼ˆå…ˆæ˜¯é€šè¿‡ psï¼‰ï¼š</p>
<pre><code class="language-sh"># æ‰¾åˆ°ç›¸åº”è¿›ç¨‹çš„ IDï¼ˆå…¶å®å·²ç»åŒ…å«çº¿ç¨‹çŠ¶æ€äº†ï¼‰
ps aux
...

# æŸ¥çœ‹è¿›ç¨‹çš„çŠ¶æ€
ps &lt;pid&gt;
  PID TTY      STAT   TIME COMMAND
31938 ?        Sl   385:59 ./build/tools/caffe train --solver=models/VGGNet/VOC0712/SSD_300x300/solver.prototxt --weights=models/VGGNet/VGG_ILSVRC_16_layers_fc_reduced.caffemodel --gpu 0,1,2,3
</code></pre>
<p>æˆ‘è§‚å¯Ÿäº†ä¸€ä¸‹ï¼Œè·‘ 200 æ¬¡è¿­ä»£éœ€è¦ 123 ç§’ã€‚è¿™æ¬¡è®­ç»ƒéœ€è¦ 120k æ¬¡è¿­ä»£ï¼Œå¤§æ¦‚è¦è·‘ 20 ä¸ªå°æ—¶â€¦æ¼«é•¿ç­‰å¾…ä¹‹åï¼Œå¯ä»¥åœ¨ <code>$HOME/data/VOCdevkit/results/VOC2007/SSD_300x300/</code> çœ‹åˆ°è¿è¡Œçš„ç»“æœï¼š</p>
<p><img src="images/results.png" alt="è®­ç»ƒç»“æœ"></p>
<p>è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹åœ¨ <code>$CAFFE_ROOT/models/VGGNet/VOC0712/SSD_300x300/</code>:</p>
<p><img src="images/models.png" alt="è®­ç»ƒæ¨¡å‹"></p>
<p>è¿˜æœ‰è¿™æ¬¡è®­ç»ƒçš„å…¶å®ƒ job file, log file, python script åœ¨ <code>$CAFFE_ROOT/jobs/VGGNet/VOC0712/SSD_300x300/</code>:</p>
<p><img src="images/stuff.png" alt="è®­ç»ƒ stuff"></p>
<h3 id="22-evaluate"><a class="markdownIt-Anchor" href="#22-evaluate">#</a> 2.2 Evaluate</h3>
<blockquote>
<p>It should reach 77.* mAP at 120k iterations.</p>
</blockquote>
<p>å®˜æ–¹è¯´èƒ½è¾¾åˆ° 77 çš„ mAPï¼Œç°åœ¨æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<pre><code class="language-sh">python examples/ssd/score_ssd_pascal.py
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="images/mAP.png" alt="mAP"></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯æœ‰ <strong>76.99</strong> çš„ mAPï¼Œæ²¡æœ‰ 77 æœ‰ç‚¹å°å¤±æœ›ã€‚</p>
<h3 id="23-test-using-a-webcam"><a class="markdownIt-Anchor" href="#23-test-using-a-webcam">#</a> 2.3 Test Using a Webcam</h3>
<p>è¿™ä¸€æ­¥å°±ç®—äº†ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰ç½‘ç»œæ‘„åƒå¤´ã€‚</p>
<h3 id="24-test"><a class="markdownIt-Anchor" href="#24-test">#</a> 2.4 Test</h3>
<blockquote>
<p>Check out examples/ssd_detect.ipynb or examples/ssd/ssd_detect.cpp on how to detect objects using a SSD model. Check out examples/ssd/plot_detections.py on how to plot detection results output by ssd_detect.cpp.</p>
</blockquote>
<p>è¿™é‡Œæ˜¯åœ¨è¯´æœ‰ Jupyter æ–‡æ¡£è¯´æ˜å¦‚ä½•ç”¨ SSD æ¥åšç›®æ ‡æ£€æµ‹ä»¥åŠå¦‚ä½•åœˆå‡ºæ£€æµ‹ç»“æœã€‚æˆ‘æŠŠ Jupyter è½¬æˆäº† HTMLï¼š<a href="assets/ssd_detect.html">examples/ssd_detect.ipynb</a>ã€‚</p>
<p>é™„ä¸Š <a href="assets/ssd_detect.cpp">examples/ssd/ssd_detect.cpp</a> å’Œ <a href="assets/plot_detections.py">examples/ssd/plot_detections.py</a>ã€‚</p>
<h3 id="25-train-on-other-dataset"><a class="markdownIt-Anchor" href="#25-train-on-other-dataset">#</a> 2.5 Train on Other Dataset</h3>
<blockquote>
<p>To train on other dataset, please refer to data/OTHERDATASET for more details. We currently add support for COCO and ILSVRC2016. We recommend using examples/ssd.ipynb to check whether the new dataset is prepared correctly.</p>
</blockquote>
<p>æˆ‘å°è¯•ç€è·‘ examples/ssd_detect.ipynb é‡Œé¢çš„ä»£ç ï¼Œä½†æ˜¯äººå®¶æ˜¯ IPython è§£é‡Šå™¨è·‘çš„ï¼Œæ‰€ä»¥è¿™ä¸€å¥ï¼š<code>%matplotlib inline</code> ä¸èƒ½åœ¨ CPython é‡Œé¢è¿è¡Œï¼ˆæˆ‘ä¹Ÿä¸äº†è§£æ€ä¹ˆæŠŠè¿™å¥ç¿»è¯‘åˆ° CPython é‡Œé¢ï¼‰ã€‚æ‰€ä»¥ä¹Ÿæ˜¾ç¤ºä¸äº†æœ€ç»ˆçš„æ•ˆæœå›¾ï¼Œä½†æ˜¯ä»£ç æ˜¯å¯ä»¥è·‘èµ·æ¥çš„ï¼Œè¿™å°±å¤Ÿå•¦å˜¿å˜¿ã€‚ä»£ç çš„æ€è·¯ï¼š</p>
<ol>
<li>è®¾ç½® caffe çš„åŸºæœ¬é…ç½®ï¼ˆCAFFE_ROOTï¼‰</li>
<li>å¼•å…¥è®­ç»ƒå¥½åˆ°æ¨¡å‹ <code>models/VGGNet/VOC0712/SSD_300x300/VGG_VOC0712_SSD_300x300_iter_120000.caffemodel</code></li>
<li>åŠ è½½æµ‹è¯•å›¾ç‰‡ï¼Œå–‚åˆ°æ¨¡å‹é‡Œé¢ï¼Œå¾—åˆ° classsification score å’Œ bounding box</li>
</ol>
<h2 id="3-btw"><a class="markdownIt-Anchor" href="#3-btw">#</a> 3. BTW</h2>
<h3 id="31-linux-è¿›ç¨‹çŠ¶æ€"><a class="markdownIt-Anchor" href="#31-linux-è¿›ç¨‹çŠ¶æ€">#</a> 3.1 Linux è¿›ç¨‹çŠ¶æ€</h3>
<ul>
<li><code>D</code> ä¸å¯ä¸­æ–­ Uninterruptible sleep(usually IO)</li>
<li><code>R</code> æ­£åœ¨è¿è¡Œï¼Œæˆ–åœ¨é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹</li>
<li><code>S</code> å¤„äºä¼‘çœ çŠ¶æ€</li>
<li><code>T</code> åœæ­¢æˆ–è¢«è¿½è¸ª</li>
<li><code>Z</code> åƒµå°¸è¿›ç¨‹</li>
<li><code>W</code> è¿›å…¥å†…å­˜äº¤æ¢ï¼ˆä»å†…æ ¸ 2.6 å¼€å§‹æ— æ•ˆï¼‰</li>
<li><code>X</code> æ­»æ‰çš„è¿›ç¨‹</li>
</ul>
<p>è¿›ç¨‹çŠ¶æ€çš„ä¿®é¥°ï¼š</p>
<ul>
<li><code>&lt;</code> é«˜ä¼˜å…ˆçº§</li>
<li><code>N</code> ä½ä¼˜å…ˆçº§</li>
<li><code>L</code> æœ‰äº›é¡µè¢«é”è¿›å†…å­˜</li>
<li><code>s</code> åŒ…å«å­è¿›ç¨‹</li>
<li><code>+</code> ä½äºåå°çš„è¿›ç¨‹ç»„</li>
<li><code>l</code> å¤šçº¿ç¨‹ï¼Œå…‹éš†çº¿ç¨‹</li>
</ul>
<h3 id="32-tmux-å¸¸ç”¨æ“ä½œ"><a class="markdownIt-Anchor" href="#32-tmux-å¸¸ç”¨æ“ä½œ">#</a> 3.2 tmux å¸¸ç”¨æ“ä½œ</h3>
<ul>
<li><code>tmux new -s &lt;name&gt;</code> æ–°å»ºä¼šè¯å¹¶å–ä¸ªåå­—ã€‚</li>
<li><code>tmux ls</code> æŸ¥çœ‹æ‰€æœ‰ä¼šè¯ã€‚</li>
<li><code>tmux a -t &lt;name&gt;</code> è¿›å…¥æŸä¸ªä¼šè¯ã€‚</li>
<li><code>tmux kill-session -t &lt;name&gt;</code> ç»ˆæ­¢æŸä¸ªä¼šè¯ã€‚</li>
<li><code>Ctrl + B + D</code> é€€å‡ºæŸä¸ªä¼šè¯ï¼ˆä»åœ¨åå°ï¼‰ã€‚</li>
<li><code>Ctrl + B + S</code> åˆ‡æ¢åˆ°å¦å¤–çš„ä¼šè¯ã€‚</li>
</ul>
<h3 id="33-åœ¨-macos-terminal-é€šè¿‡-ssh-æ˜¾ç¤ºæœåŠ¡å™¨çš„å›¾å½¢åŒ–ç•Œé¢"><a class="markdownIt-Anchor" href="#33-åœ¨-macos-terminal-é€šè¿‡-ssh-æ˜¾ç¤ºæœåŠ¡å™¨çš„å›¾å½¢åŒ–ç•Œé¢">#</a> 3.3 åœ¨ macOS Terminal é€šè¿‡ ssh æ˜¾ç¤ºæœåŠ¡å™¨çš„å›¾å½¢åŒ–ç•Œé¢</h3>
<blockquote>
<p><a href="https://uisapp2.iu.edu/confluence-prd/pages/viewpage.action?pageId=280461906">https://uisapp2.iu.edu/confluence-prd/pages/viewpage.action?pageId=280461906</a></p>
</blockquote>
<ol>
<li>mac æœ¬åœ°å…ˆå®‰è£… <a href="https://www.xquartz.org">XQuartz</a></li>
<li>ssh è¿æ¥çš„æ—¶å€™å¸¦ä¸Š <code>-X</code> å‚æ•°ï¼š<code>ssh user@host -X</code></li>
<li>ä¹‹åï¼Œåœ¨ ssh é‡Œé¢è¿›è¡Œå›¾å½¢åŒ–ç›¸å…³çš„æ“ä½œï¼Œå°±ä¼šåœ¨ mac æœ¬åœ°æ˜¾ç¤ºå‡ºæ¥</li>
</ol>
<h2 id="4-resources"><a class="markdownIt-Anchor" href="#4-resources">#</a> 4. Resources</h2>
<ul>
<li><a href="../papers/SSD.pdf">SSD: Single Shot MultiBox Detector</a></li>
<li>å®˜æ–¹æºç ï¼š<a href="https://github.com/weiliu89/caffe/tree/ssd">https://github.com/weiliu89/caffe/tree/ssd</a></li>
</ul>
</body>
</html>