<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Faster R-CNN å­¦ä¹ ç¬”è®°</title>
<link rel="shortcut icon" href="../../assets/img/icon.png" type="image/x-icon"/>
<link rel="icon" href="../../assets/img/icon.png" type="image/x-icon"/>
<link rel="stylesheet" href="../../assets/css/github-markdown.css">
<link rel="stylesheet" href="../../assets/css/index.css">
</head>
<body class="markdown-body">
<p><a href="https://painterdrown.github.io">painterdrown Blog</a> - <a href="https://painterdrown.github.io/cv">painterdrown CV</a></p>
<h1 id="faster-r-cnn-å­¦ä¹ ç¬”è®°"><a class="markdownIt-Anchor" href="#faster-r-cnn-å­¦ä¹ ç¬”è®°">#</a> Faster R-CNN å­¦ä¹ ç¬”è®°</h1>
<blockquote>
<p>â° 2018-05-30 15:50:27<br/>
ğŸ‘¨ğŸ»â€ğŸ’» painterdrown</p>
</blockquote>
<p><ul class="markdownIt-TOC">
<li><a href="#faster-r-cnn-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">Faster R-CNN å­¦ä¹ ç¬”è®°</a>
<ul>
<li><a href="#0-abstract">0. Abstract</a></li>
<li><a href="#1-introduction">1. Introduction</a></li>
<li><a href="#2-faster-r-cnn">2. Faster R-CNN</a>
<ul>
<li><a href="#21-region-proposal-networks">2.1. Region Proposal Networks</a>
<ul>
<li><a href="#211-anchors">2.1.1 Anchors</a></li>
<li><a href="#212-loss-function">2.1.2 Loss Function</a></li>
<li><a href="#213-training-rpns">2.1.3 Training RPNs</a></li>
</ul>
</li>
<li><a href="#22-sharing-features-for-rpn-and-fast-r-cnn">2.2. Sharing Features for RPN and Fast R-CNN</a></li>
<li><a href="#23-implementation-details">2.3. Implementation Details</a></li>
</ul>
</li>
<li><a href="#3-resources">3. Resources</a></li>
</ul>
</li>
</ul>
</p>
<p>æœ€è¿‘è¦å‡†çœ‹è§†é¢‘ç›®æ ‡æ£€æµ‹é‡Œé¢çš„ R-FCNï¼Œå¬å°ä¼™ä¼´è¯´æ¶‰åŠäº†å¾ˆå¤š Faster R-CNN çš„å†…å®¹ï¼Œä¹‹å‰çœ‹ Faster R-CNN çš„æ—¶å€™èµ¶æ—¶é—´æ²¡åšç¬”è®°ï¼Œç°åœ¨è¡¥å›æ¥ã€‚</p>
<h2 id="0-abstract"><a class="markdownIt-Anchor" href="#0-abstract">#</a> 0. Abstract</h2>
<p>ç›®å‰æœ€å‰æ²¿çš„ç›®æ ‡æ£€æµ‹ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œéƒ½æ˜¯ä¾èµ–äº region proposal algorithmsï¼ˆåŒºåŸŸå»ºè®®ç®—æ³•ï¼‰æ¥å‡å®šå›¾åƒä¸­ç›®æ ‡çš„ä½ç½®ã€‚åœ¨æ£€æµ‹æ–¹é¢ï¼ŒFast R-CNN åœ¨é€Ÿåº¦ä¸Šå·²ç»åšå¾—æŒºä¸é”™äº†ï¼Œç°åœ¨ä¸»è¦çš„ç“¶é¢ˆåœ¨äº region proposal çš„è®¡ç®—ä¸Šã€‚å°±ç›®æ ‡æ£€æµ‹æ¥è¯´ï¼Œä¹‹å‰çš„åšæ³•éƒ½ä¸æ˜¯ç«¯åˆ°ç«¯çš„ï¼Œå› ä¸ºè¦å…ˆè®¡ç®—å‡º region proposalï¼Œå†æŠŠå®ƒæ‰”åˆ°ç½‘ç»œä¸­å»è¿›è¡Œæ£€æµ‹ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ç¯‡è®ºæ–‡ä»‹ç»äº† Region Proposal Network (RPN) ï¼Œè¿™ä¸ªç½‘ç»œå°†ç”¨äºè®¡ç®— region proposalï¼Œè€Œä¸”å¯ä»¥ä¸åé¢çš„ detection network å…±äº« convolutional featuresã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æŠŠè¿™ä¸¤éƒ¨åˆ†å·¥ä½œç»™ç»“åˆèµ·æ¥ï¼šRPN å…ˆç®—å‡ºå›¾ç‰‡ä¸­ç›®æ ‡çš„ä½ç½®ä»¥åŠå¯¹åº”çš„ç½®ä¿¡åº¦ï¼Œå†å°†è¿™éƒ¨åˆ†ä¿¡æ¯ä¼ é€’ç»™ Fast R-CNN ç½‘ç»œè¿›è¡Œæ£€æµ‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™é‡Œç†è§£ï¼š<code>Faster R-CNN = RPN + Fast R-CNN</code>ã€‚Faster R-CNN é€šè¿‡ â€œattentionâ€ å°†ä¸¤è€…åˆå¹¶ä¸ºä¸€ä¸ªå•ä¸€çš„ç«¯åˆ°ç«¯çš„ç›®æ ‡æ£€æµ‹ç½‘ç»œã€‚</p>
<h2 id="1-introduction"><a class="markdownIt-Anchor" href="#1-introduction">#</a> 1. Introduction</h2>
<p>ç°åœ¨å¾ˆå¤š region proposal algorithms éƒ½æ˜¯ç”¨çš„ <a href="../papers/Selective_Search.pdf">Selective Search</a>ï¼Œæ•ˆæœä¸Šæ¯”è¾ƒä¸ç†æƒ³ã€‚è€Œä¸”æ˜¯è·‘åœ¨ CPU ä¸Šçš„ï¼Œå¦‚æœåªæ˜¯å•å•å°†å…¶é‡æ„ä¸º GPU ç‰ˆæœ¬ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•è·Ÿæ¥ä¸‹æ¥çš„æ£€æµ‹ç½‘ç»œåˆ†äº«è®¡ç®—ç»“æœã€‚</p>
<p>Faster R-CNN ä½¿ç”¨æ·±åº¦å·ç§¯ç½‘ç»œæ¥è®¡ç®— region proposalsï¼Œå¯ä»¥è¯´æ˜¯æœ€å¤§çš„ä¸€ä¸ªäº®ç‚¹ã€‚ä½œè€…è§‚å¯Ÿåˆ°ï¼ŒFast R-CNN æ£€æµ‹ç½‘ç»œç”¨åˆ°çš„ convolutional feature mapsï¼Œä¹Ÿå¯ä»¥ç”¨äºç”Ÿæˆ region proposalsã€‚åœ¨ RPN çš„ convolutional features ä¹‹ä¸Šï¼Œä½œè€…åŠ äº†ä¸€å±‚å·ç§¯æ¥åŒæ—¶åšè¾¹ç•Œå›å½’å’Œç›®æ ‡ç½®ä¿¡åº¦è®¡ç®—ï¼Œè¿™ä½¿å¾— RPN æˆä¸ºå…¨å·ç§¯ç½‘ç»œ (FCN)ï¼Œå¯ä»¥ç«¯åˆ°ç«¯åœ°ç”Ÿæˆ region proposalsã€‚</p>
<p><img src="images/addressing.png" alt=""></p>
<p>ä¸Šé¢ä»‹ç»äº†ä¸‰ç§é€‰æ‹© egion proposals çš„ç­–ç•¥ï¼ŒFaster R-CNN é‡‡ç”¨çš„æ˜¯ç¬¬ä¸‰ç§ï¼Œç§°ä¸ºâ€œé”šç‚¹â€ã€‚</p>
<p>è®­ç»ƒçš„ Faster R-CNN çš„ç­–ç•¥ï¼šå›ºå®šæŸä¸ª proposalsï¼Œäº¤æ›¿åœ°è¿›è¡Œ region proposal çš„è°ƒä¼˜ä»¥åŠ object detection çš„è°ƒä¼˜ã€‚è¿™ç§è®­ç»ƒæ–¹æ³•èƒ½å¤Ÿå¿«é€Ÿæ”¶æ•›ï¼Œå¹¶ä¸”äº§ç”Ÿä¸€ä¸ªå…±äº«çš„å¸¦æœ‰ convolutional features çš„ç»Ÿä¸€ç½‘ç»œã€‚</p>
<h2 id="2-faster-r-cnn"><a class="markdownIt-Anchor" href="#2-faster-r-cnn">#</a> 2. Faster R-CNN</h2>
<p><img src="images/architecture.png" alt=""></p>
<h3 id="21-region-proposal-networks"><a class="markdownIt-Anchor" href="#21-region-proposal-networks">#</a> 2.1. Region Proposal Networks</h3>
<p>ç”±äºè¦å’Œ Fast R-CNN å…±äº«è®¡ç®—ï¼Œä½œè€…å‡è®¾è¿™ä¸¤éƒ¨åˆ†ç½‘ç»œéƒ½å…±äº«ä¸€ç³»åˆ—ç›¸åŒçš„å·ç§¯å±‚ã€‚RPN æœ€åä¸€ä¸ª shared convolutional layer ä¼šè¾“å‡ºå¯åˆ†äº«çš„ convolutional feature mapï¼Œç„¶ååœ¨å®ƒä¸Šé¢ â€œslide a small networkâ€ æ¥ç”Ÿæˆ region proposalsã€‚è¿™ä¸ªæ»‘åŠ¨çš„å°ç½‘ç»œå±‚çš„è¾“å…¥æ˜¯ nÃ—nÃ—dï¼ˆä½œè€…å– n = 3ï¼Œè€Œ d å–å†³äº convolutional feature map çš„é€šé“æ•°ï¼‰ï¼Œç„¶åè¿™ä¸ªè¾“å…¥ä¼šè¢«æ˜ å°„ä¸ºä½ç»´ç‰¹å¾ã€‚è¿™äº›ä½ç»´çš„ç‰¹å¾å°†è¢«è¾“é€ç»™ä¸¤ä¸ªå…„å¼Ÿå…¨è¿æ¥å±‚ï¼š</p>
<ul>
<li>box-regression layer (reg)</li>
<li>box-classification layer (cls)</li>
</ul>
<p><img src="images/RPN.png" alt=""></p>
<h4 id="211-anchors"><a class="markdownIt-Anchor" href="#211-anchors">#</a> 2.1.1 Anchors</h4>
<p>å¯¹äºæ¯ä¸€ä¸ª sliding-windowï¼Œæˆ‘ä»¬éƒ½ä¼šé€‰æ‹©å‡ ä¸ª region proposalsï¼ˆæœ€å¤š k ä¸ªï¼‰ã€‚å› æ­¤ reg å±‚è¾“å‡ºçš„å‚æ•°æœ€å¤šä¸º 4kï¼Œcls è¾“å‡ºçš„å‚æ•°æœ€å¤šä¸º 2kï¼ˆæœ‰ç›®æ ‡çš„æ¦‚ç‡å’Œæ— ç›®æ ‡çš„æ¦‚ç‡ï¼Œå…¶å®çœ‹æˆåªæœ‰ 1k ä¸ªå‚æ•°ä¹Ÿæ²¡æ¯›ç—…ï¼Œå› ä¸ºä¸¤è€…åŠ èµ·æ¥ä¸º 1ï¼‰ã€‚è¿™ k ç»„ proposals æ˜¯ç”±ä¸€ä¸ª anchorï¼ˆé”šç‚¹ï¼‰é€šè¿‡ä¸åŒçš„å‚æ•° (scale &amp; aspect ratio) æ¥ç¡®å®šçš„ã€‚å…¶ä¸­ï¼Œ</p>
<ul>
<li><strong>scale</strong> æ˜¯ proposals çš„å°ºå¯¸ï¼ˆåº”è¯¥å¯ä»¥ç†è§£ä¸ºé¢ç§¯ï¼‰ï¼Œä¹Ÿå°±æ˜¯ widthÃ—height</li>
<li><strong>aspect ratio</strong> æ˜¯ proposals çš„é•¿å®½æ¯”ï¼Œä¹Ÿå°±æ˜¯ width:height</li>
</ul>
<p>å…³äºé”šç‚¹ï¼Œä½œè€…é«˜äº®äº†ä¸¤ç‚¹ï¼š</p>
<ul>
<li><strong>Translation-Invariant Anchors</strong> ã€‚å›¾åƒçš„è½¬æ¢å¯¹äºé”šç‚¹åŠå…¶ proposals è®¡ç®—å‡½æ•°æ¥è¯´ï¼Œæ˜¯å…·æœ‰ä¸å˜å½¢çš„ï¼ˆè¿™ä¸€ç‚¹æˆ‘æš‚æ— æ·±å…¥çš„ç†è§£ï¼‰ã€‚</li>
<li><strong>Multi-Scale Anchors as Regression References</strong>ã€‚æ„æ€æ˜¯ Faster R-CNN çš„é”šç‚¹æ˜¯åŸºäº â€œa pyramid of anchorsâ€ï¼Œè¿™ç§é€‰ proposals çš„ç­–ç•¥æ¯”è¾ƒé«˜æ•ˆï¼Œå› ä¸ºå…¨ç¨‹åªç”¨è®¡ç®—è¾“å…¥å›¾åƒä¸€ä¸ª scale ä¸‹çš„ convolutional features å°±å¥½ã€‚</li>
</ul>
<h4 id="212-loss-function"><a class="markdownIt-Anchor" href="#212-loss-function">#</a> 2.1.2 Loss Function</h4>
<p>åœ¨è®­ç»ƒ RPN çš„æ—¶å€™ï¼Œå°†æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶å…¶ä¸­ä¹‹ä¸€çš„æ ·æœ¬æ ‡è®°ä¸ºæ­£ï¼š</p>
<ol>
<li>anchors with the highest Intersection-over-Union (<strong>IoU</strong>) overlap with a <strong>ground-truth box</strong></li>
<li>an anchor that has an IoU overlap higher than 0.7 with any ground-truth box</li>
</ol>
<p>å…¶ä¸­ï¼Œground-truth box æ˜¯æŒ‡è®­ç»ƒé›†ä¸­é¢„æ ‡æ³¨å¥½çš„æœ‰ç›®æ ‡çš„æ¡†ã€‚</p>
<p>è¿™é‡Œæ²¿ç”¨äº† Fast R-CNN çš„æŸå¤±å‡½æ•°ï¼š</p>
<p><img src="images/loss_function.png" alt=""></p>
<p>è¿™ä¸ªæŸå¤±å‡½æ•°åŒæ—¶è€ƒè™‘äº† reg å’Œ cls ä¸¤ä¸ªä»»åŠ¡ã€‚</p>
<h4 id="213-training-rpns"><a class="markdownIt-Anchor" href="#213-training-rpns">#</a> 2.1.3 Training RPNs</h4>
<p>RPN çš„è®­ç»ƒæ˜¯ç«¯åˆ°ç«¯çš„ï¼Œé€šè¿‡<strong>åå‘ä¼ æ’­</strong>å’Œ<strong>éšæœºæ¢¯åº¦ä¸‹é™</strong>ã€‚</p>
<ul>
<li>æ¢¯åº¦ä¸‹é™çš„æ—¶å€™ï¼Œä¸€ä¸ª mini-batch ä¸­çš„æ‰€æœ‰æ ·æœ¬å–è‡ªåŒä¸€å¼ å›¾ç‰‡</li>
<li>æ¯ä¸€å¼ å›¾ç‰‡éšæœºåœ°é‡‡æ · 256 ä¸ª anchorsï¼ˆæ­£è´Ÿæ ·æœ¬æ¯”ä¾‹æ§åˆ¶ä¸º 1:1ï¼‰</li>
<li>æ–°å±‚çš„å‚æ•°é‡‡ç”¨ 0 å‡å€¼ï¼Œ0.01 æ ‡å‡†å·®ä¸‹é«˜æ–¯åˆ†å¸ƒçš„éšæœºåˆå§‹åŒ–</li>
<li>å…¶ä»–å±‚ç”¨ ImageNet Classsification é¢„è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹è¿›è¡Œåˆå§‹åŒ–</li>
<li>å‰ 60k mini-batches çš„å­¦ä¹ ç‡ä¸º 0.001ï¼Œå 20k mini-batches çš„å­¦ä¹ ç‡ä¸º 0.0001</li>
<li>0.9 momentum, 0.0005 weight decay</li>
</ul>
<h3 id="22-sharing-features-for-rpn-and-fast-r-cnn"><a class="markdownIt-Anchor" href="#22-sharing-features-for-rpn-and-fast-r-cnn">#</a> 2.2. Sharing Features for RPN and Fast R-CNN</h3>
<p>ä¸€å¼€å§‹ï¼ŒRPN å’Œ Fast R-CNN æ˜¯ç‹¬ç«‹è¿›è¡Œè®­ç»ƒçš„ï¼Œä¼šä»¥ä¸åŒçš„æ–¹å¼å„è‡ªä¿®æ”¹ä»–ä»¬çš„å·ç§¯å±‚ã€‚è¦ä½¿ä»–ä»¬èƒ½å¤Ÿå…±äº«å·ç§¯ï¼Œæœ‰ä¸‰ä¸ªå…³é”®ï¼š</p>
<ol>
<li>
<p><strong>Alternating trainingï¼ˆäº¤æ›¿è®­ç»ƒï¼‰</strong>ã€‚é¦–å…ˆå…ˆå°† RPN è®­ç»ƒå‡ºæ¥ï¼Œå¾—å‡º proposals åå»è®­ç»ƒ Fast R-CNNï¼Œç„¶åå†ç”¨ Fast R-CNN è°ƒä¼˜å‡ºæ¥çš„ç½‘ç»œå»åˆå§‹åŒ– RPNï¼Œä¸æ–­è¿­ä»£è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
</li>
<li>
<p><strong>Approximate joint trainingï¼ˆè¿‘ä¼¼è”åˆè®­ç»ƒï¼‰</strong>ã€‚åœ¨åšå‰å‘çš„æ—¶å€™ï¼Œå°† RPN å¾—å‡ºæ¥çš„ proposals è®¤ä¸ºæ˜¯ fixed, pre-computed çš„ï¼Œç„¶åä¼ ç»™ Fast R-CNNã€‚åå‘ä¼ æ’­çš„æ—¶å€™ï¼Œï¼ˆä¸¤ä¸ªç½‘ç»œçš„ï¼‰å…±äº«å±‚ä¼šåŒæ—¶å—åˆ° RPN loss å’Œ Fast R-CNN loss çš„å½±å“ã€‚ç”±äºå¿½ç•¥äº† proposal boxesâ€™ coordinates çš„å¾®åˆ†ï¼Œæ‰€ä»¥è¯´æ˜¯è¿‘ä¼¼çš„ã€‚</p>
</li>
<li>
<p><strong>Non-approximate joint trainingï¼ˆéæœ€å¤§åŒ–è”åˆè®­ç»ƒï¼‰</strong>ã€‚è™½ç„¶ Approximate joint training å¿½ç•¥äº† predicted bounding boxes åæ ‡çš„æ¢¯åº¦ï¼Œä½†æ˜¯åœ¨ RoI æ± åŒ–å±‚æˆ‘ä»¬éœ€è¦ä¿è¯ predicted bounding boxes çš„åæ ‡æ˜¯å¯å¾®çš„ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ â€œRoI warpingâ€ å±‚è§£å†³ï¼ˆè¶…çº²ä¸è§£é‡Š hhhï¼‰ã€‚</p>
</li>
</ol>
<p>æ€»ç»“èµ·æ¥ï¼Œæœ‰ä»¥ä¸‹å››æ­¥ï¼ˆæ„Ÿè§‰æ²¡å¿…è¦ç¿»è¯‘ï¼‰ï¼š</p>
<ol>
<li>
<p>We train the RPN initialized with an ImageNet-pre-trained model and fine-tuned end-to-end for the region proposal task.</p>
</li>
<li>
<p>We train a separate detection network by Fast R-CNN (also initialized by the ImageNet-pre-trained model) using the proposals generated by the step-1 RPN.</p>
</li>
<li>
<p>We use the detector network to initialize RPN training, but we fix the shared convolutional layers and only fine-tune the layers unique to RPN.</p>
</li>
<li>
<p>We fine-tune the unique layers of Fast R-CNN, keeping the shared convolutional layers fixed.</p>
</li>
</ol>
<h3 id="23-implementation-details"><a class="markdownIt-Anchor" href="#23-implementation-details">#</a> 2.3. Implementation Details</h3>
<p>å®ç°ç»†èŠ‚å°±è‡ªè¡Œçœ‹è®ºæ–‡å•¦ï¼Œä¸ä½œèµ˜è¿°ã€‚</p>
<h2 id="3-resources"><a class="markdownIt-Anchor" href="#3-resources">#</a> 3. Resources</h2>
<ul>
<li><a href="../papers/Faster_R-CNN.pdf">Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks</a></li>
<li><a href="https://github.com/shaoqingren/faster_rcnn">GitHub (MATLAB)</a></li>
<li><a href="https://github.com/rbgirshick/py-faster-rcnn">GitHub (python)</a></li>
</ul>
</body>
</html>